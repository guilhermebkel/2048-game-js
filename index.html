<!DOCTYPE html>
<html>
	<head>
		<title>2048 Game</title>

		<style>
			.board {
				width: 500px;
				height: 500px;

				background-color: #B8ADA1;

				display: grid;
				grid-template-columns: 1fr 1fr 1fr 1fr;
				grid-template-rows: 1fr 1fr 1fr 1fr;
				grid-gap: 8px;

				padding: 8px;
			}

			.square {
				background-color: #CAC0B5;
				
				display: flex;
				justify-content: center;
				align-items: center;

				font-size: 48px;
				font-weight: bolder;
			}
		</style>
	</head>
	<body>
		<div class="board">
			<div class="square">
				2
			</div>

			<div class="square">
				2
			</div>

			<div class="square">
				2
			</div>

			<div class="square">
				2
			</div>

			<div class="square">
				2
			</div>

			<div class="square">
				2
			</div>

			<div class="square">
				2
			</div>

			<div class="square">
				2
			</div>

			<div class="square">
				2
			</div>

			<div class="square">
				2
			</div>

			<div class="square">
				2
			</div>

			<div class="square">
				2
			</div>

			<div class="square">
				2
			</div>

			<div class="square">
				2
			</div>

			<div class="square">
				2
			</div>

			<div class="square">
				2
			</div>
		</div>

		<script>
			const MAX_AMOUNT = 4

			const squareElements = document.getElementsByClassName("square")

			const table = []

			for (let row = 0; row < MAX_AMOUNT; row++) {
				table[row] = []

				for (let column = 0; column < MAX_AMOUNT; column++) {
					const squareElementIndex = ((MAX_AMOUNT * row) + column)

					table[row][column] = squareElements[squareElementIndex]
				}
			}

			async function moveSquares({
				iterateFrom,
				iterateTo,
				iterateBy,
				compareLower,
				compareHigher,
				buildMatrixPath
			}) {
				for (let row = 0; row < MAX_AMOUNT; row++) {
					for (let targetColumn = iterateFrom; targetColumn !== iterateTo + iterateBy; targetColumn += iterateBy) {
						const initialTargetSquareElement = buildMatrixPath(table, row, targetColumn)

						let currentTargetSquarePosition = targetColumn

						for (let columnToCompare = iterateFrom; columnToCompare !== iterateTo + iterateBy; columnToCompare += iterateBy) {
							const squareToCompareElement = buildMatrixPath(table, row, columnToCompare)
							const currentTargetSquareElement = buildMatrixPath(table, row, currentTargetSquarePosition)

							if (targetColumn === columnToCompare) {
								continue
							}

							const isTargetSquareElementMovable = initialTargetSquareElement.innerText && !squareToCompareElement.innerText
							const areSquareValuesEqual = currentTargetSquareElement.innerText === squareToCompareElement.innerText
							const areSquareValuesValid = currentTargetSquareElement.innerText && squareToCompareElement.innerText
							const isTargetColumnBeingComparedWithLowerColumn = compareLower(columnToCompare, targetColumn)
							const isTargetColumnBeingComparedWithHigherColumn = compareHigher(columnToCompare, targetColumn)

							/**
							 * Sum equal elements
							 */
							if (isTargetColumnBeingComparedWithLowerColumn && areSquareValuesValid) {
								if (areSquareValuesEqual) {
									currentTargetSquareElement.innerText = Number(currentTargetSquareElement.innerText) + Number(squareToCompareElement.innerText)

									squareToCompareElement.innerText = ""

									break
								} else {
									break
								}
							}

							/**
							 * Move elements to blank spaces
							 */
							if (isTargetColumnBeingComparedWithHigherColumn && isTargetSquareElementMovable) {
								squareToCompareElement.innerText = initialTargetSquareElement.innerText

								currentTargetSquarePosition = columnToCompare

								initialTargetSquareElement.innerText = ""
							}
						}
					}
				}
			}

			window.addEventListener("keydown", async function(event) {
				// ArrowRight, ArrowUp, ArrowLeft, ArrowDown
				const keyPressed = event.key

				if (keyPressed === "ArrowRight") {
					moveSquares({
						iterateFrom: MAX_AMOUNT - 1,
						iterateTo: 0,
						iterateBy: -1,
						compareHigher: (valueToCompare, targetValue) => valueToCompare >= targetValue,
						compareLower: (valueToCompare, targetValue) => valueToCompare <= targetValue,
						buildMatrixPath: (table, row, column) => table[row][column]
					})
				} else if (keyPressed === "ArrowDown") {
					moveSquares({
						iterateFrom: MAX_AMOUNT - 1,
						iterateTo: 0,
						iterateBy: -1,
						compareHigher: (valueToCompare, targetValue) => valueToCompare >= targetValue,
						compareLower: (valueToCompare, targetValue) => valueToCompare <= targetValue,
						buildMatrixPath: (table, row, column) => table[column][row]
					})
				} else if (keyPressed === "ArrowLeft") {
					moveSquares({
						iterateFrom: 0,
						iterateTo: MAX_AMOUNT - 1,
						iterateBy: +1,
						compareHigher: (valueToCompare, targetValue) => valueToCompare <= targetValue,
						compareLower: (valueToCompare, targetValue) => valueToCompare >= targetValue,
						buildMatrixPath: (table, row, column) => table[row][column]
					})
				} else if (keyPressed === "ArrowUp") {
					moveSquares({
						iterateFrom: 0,
						iterateTo: MAX_AMOUNT - 1,
						iterateBy: +1,
						compareHigher: (valueToCompare, targetValue) => valueToCompare <= targetValue,
						compareLower: (valueToCompare, targetValue) => valueToCompare >= targetValue,
						buildMatrixPath: (table, row, column) => table[column][row]
					})
				}
			})
		</script>
	</body>
</html>